# Node-RED ‚Äì Module de Supervision et de Traitement

##  R√¥le dans l‚ÄôArchitecture Globale

Node-RED constitue la couche logicielle de traitement des donn√©es satellite.

Il assure :

- La r√©ception des trames uplink via MQTT
- Le d√©codage du payload encod√© en Base64
- L‚Äôinterpr√©tation structur√©e des √©v√©nements
- La validation temporelle des alertes
- La gestion d‚Äô√©tat (anti-spam)
- La g√©n√©ration d‚Äôalertes email
- La supervision en temps r√©el via Dashboard

---

## Architecture Logique du Flow

```
MQTT IN
   ‚Üì
D√©codage Base64
   ‚Üì
Parsing & Structuration des donn√©es
   ‚Üì
Logique d√©cisionnelle (State Management)
   ‚Üì
Syst√®me d‚Äôalerte (Email)
   ‚Üì
Dashboard de supervision
```

---

##  R√©ception des Donn√©es

- Topic MQTT : `cma/echo/117a62/uplink`
- Les trames re√ßues contiennent un champ `frmPayload`
- Ce champ est encod√© en Base64

Exemple re√ßu :

```
"FEU,153,40.6"
"SOS,28.1"
"ALIVE"


## üîç D√©codage et Structuration

1. Conversion Base64 ‚Üí UTF-8
2. S√©paration des champs par virgule
3. Cr√©ation d‚Äôun objet structur√© :

json
{
  "event": "FEU",
  "state": "FEU",
  "angle": 153,
  "temperature": 40.6,
  "timestamp": "ISO-8601"
}


##  Logique D√©cisionnelle

###  D√©tection FEU

Condition stricte :

- Temp√©rature > 32¬∞C
- Condition maintenue pendant ‚â• 3 secondes cons√©cutives
- Validation temporelle via `context`
- Envoi d‚Äôun seul email par √©v√©nement confirm√©

Objectif : √©limination des faux positifs thermiques instantan√©s.

---

###  Gestion SOS

- Envoi imm√©diat d‚Äôun email
- Blocage des envois r√©p√©t√©s
- R√©initialisation uniquement si l‚Äô√©tat change

Impl√©mentation via variable m√©moire :

```
context.set("sosSent", true)
```

---

###  ALIVE

- Indique fonctionnement normal
- Aucun envoi d‚Äôalerte
- R√©initialise l‚Äô√©tat SOS si actif

---

## Dashboard

Interface temps r√©el affichant :

- Temp√©rature
- Angle de balayage
- √âtat syst√®me (ALIVE / SOS / FEU)
- Indicateur visuel d‚Äôalerte

Acc√®s local :
```
http://localhost:1880/ui
```

Acc√®s distant possible via tunnel s√©curis√©.

---

## Syst√®me d‚ÄôAlerte

- SMTP s√©curis√© (Gmail ‚Äì port 465)
- Authentification par mot de passe d‚Äôapplication
- Un seul mail par √©v√©nement valid√©
- Protection anti-spam int√©gr√©e

---

##  Gestion d‚Äô√âtat

Utilisation de la m√©moire interne Node-RED :

- `sosSent`
- `feuStartTime`

Permet :

- Validation temporelle
- √âvitement des notifications multiples
- Robustesse √©v√©nementielle

---

##  Robustesse du Syst√®me

- Filtrage des pics thermiques courts
- Reset automatique si temp√©rature redescend
- Architecture orient√©e √©v√©nements (event-driven)
- S√©paration claire acquisition / logique / notification

---

## Technologies Utilis√©es

- Node-RED
- MQTT
- JavaScript
- Node-RED Dashboard
- SMTP s√©curis√©

---

##  Conclusion

Le module Node-RED assure la couche d‚Äôintelligence du syst√®me FireScan en garantissant :

- Fiabilit√© des alertes
- R√©duction des faux positifs
- Supervision en temps r√©el
- Automatisation compl√®te des notifications
